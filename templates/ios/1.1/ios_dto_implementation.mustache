//
//  {{{className}}}.m
//  {{{projecyName}}}
//  Version: {{{version}}}
//
//  Created by Eli Kohen
//  Copyright (c) 2012 EKGDev. All rights reserved.
//

#import "{{{dto.name}}}.h"

@implementation {{{dto.name}}}

-(NSDictionary *) writeToDictionary {
	NSMutableDictionary *dict=[[NSMutableDictionary alloc]init];

	{{#dto.baseFields}}
	{{#isBoolean}}
	[dict setValue:self.{{{javaName}}}.boolValue ? @"true": @"false" forKey:@"{{{name}}}"];
    {{/isBoolean}}
	{{^isBoolean}}
	[dict setValue:self.{{{javaName}}} forKey:@"{{{name}}}"];
	{{/isBoolean}}
	{{/dto.baseFields}}
	{{#dto.baseArrayFields}}
    {{#isBoolean}})
	[dict setValue:self.{{{javaName}}}.boolValue ? @"true": @"false" forKey:@"{{{name}}}"];
	{{/isBoolean}}
    {{^isBoolean}}
	[dict setValue:self.{{{javaName}}} forKey:@"{{{name}}}"];
	{{/isBoolean}}
	{{/dto.baseArrayFields}}
	{{#dto.objectFields}}
	NSDictionary *dict{{{javaName}}}=[self.{{{javaName}}} writeToDictionary];
	[dict setValue:dict{{{javaName}}} forKey:@"{{{name}}}"];
	{{/dto.objectFields}}
	{{#dto.objectArrayFields}}
	NSMutableArray *array{{{javaName}}}=[[NSMutableArray alloc]init];
	for({{{iosBaseTypeSingular}}} *typeItem in self.{{{javaName}}}) {
		NSDictionary *dict{{{javaName}}}=[typeItem writeToDictionary];
		[array{{{javaName}}} addObject:dict{{{javaName}}}];
	}
	[dict setValue:array{{{javaName}}} forKey:@"{{{name}}}"];
	{{/dto.objectArrayFields}}

	return dict;
}

+({{{dto.name}}} *) readFromDictionary:(NSDictionary *)dict {
	{{{dto.name}}} *instance=[[{{{dto.name}}} alloc]init];

    {{#dto.objectArrayFields}}
    instance.{{{javaName}}}=[[NSMutableArray alloc]init];
    {{/dto.objectArrayFields}}
    {{#dto.baseFields}}
    if (![[dict objectForKey:@"{{{name}}}"] isKindOfClass:[NSNull class]]) {
    	instance.{{{javaName}}}=[dict objectForKey:@"{{{name}}}"];
    }
    {{/dto.baseFields}}
    {{#dto.baseArrayFields}}
	NSArray *{{{name}}}Array=[dict objectForKey:@"{{{name}}}"];
	NSMutableArray *{{{name}}}MutableArray=[[NSMutableArray alloc]init];
	for({{{iosBaseTypeSingular}}} *item in {{{name}}}Array) {
		[{{{name}}}MutableArray addObject:item];
	}
	instance.{{{javaName}}}={{{name}}}MutableArray;
    {{/dto.baseArrayFields}}
    {{#dto.objectFields}}
	if ([dict objectForKey:@"{{{name}}}"]) {
        instance.{{{javaName}}}=[{{{type}}} readFromDictionary:[dict objectForKey:@"{{{name}}}"]];
    }
    {{/dto.objectFields}}
    {{#dto.objectArrayFields}}
	NSDictionary *{{{name}}}Item = nil;
	if(![[dict objectForKey:@"{{{name}}}"] isKindOfClass:[NSNull class]]) {
		{{{name}}}Item=[dict objectForKey:@"{{{name}}}"];
	}
	
	if([{{{name}}}Item isKindOfClass:[NSArray class]]) {
		NSArray *{{{name}}}Array=[dict objectForKey:@"{{{name}}}"];
		NSMutableArray *{{{name}}}MutableArray=[[NSMutableArray alloc]init];
		for(NSDictionary *data in {{{name}}}Array) {
			{{{iosBaseTypeSingular}}} *item=[{{{iosBaseTypeSingular}}} readFromDictionary:data];
			[{{{name}}}MutableArray addObject:item];
		}
		instance.{{{javaName}}}={{{name}}}MutableArray;
	}
	else if ({{{name}}}Item) {
		NSMutableArray *{{{name}}}MutableArray=[[NSMutableArray alloc]init];
		{{{iosBaseTypeSingular}}} *item=[{{{iosBaseTypeSingular}}} readFromDictionary:{{{name}}}Item];
		[{{{name}}}MutableArray addObject:item];
		instance.{{{javaName}}}={{{name}}}MutableArray;
	}
    {{/dto.objectArrayFields}}

	return instance;
}

// Establece valores a partir de un NSArray
+(NSArray *) readFromDictionaryArray:(NSArray *)dictArray {
	NSMutableArray *mutableArray=[[NSMutableArray alloc]init];
	for(NSDictionary *dict in dictArray) {
		[mutableArray addObject:[{{{dto.name}}} readFromDictionary:dict]];
	}
	return mutableArray;
}

@end
 